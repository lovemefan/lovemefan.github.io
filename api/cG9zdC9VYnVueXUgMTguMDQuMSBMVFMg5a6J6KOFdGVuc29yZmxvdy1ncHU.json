{"title":"Ubunyu 18.04.1 LTS 安装tensorflow-gpu","date":"2019-03-04T03:39:00.000Z","author":"lovemefan","excerpt":"","slug":"Ubunyu 18.04.1 LTS 安装tensorflow-gpu","comments":true,"tags":["学习笔记","Python","编程语言"],"updated":"2019-03-04T07:41:59.664Z","content":"<h1 id=\"Ubunyu-18-04-1-LTS-安装tensorflow-gpu\"><a href=\"#Ubunyu-18-04-1-LTS-安装tensorflow-gpu\" class=\"headerlink\" title=\"Ubunyu 18.04.1 LTS 安装tensorflow-gpu\"></a>Ubunyu 18.04.1 LTS 安装tensorflow-gpu</h1><h2 id=\"1-安装驱动\"><a href=\"#1-安装驱动\" class=\"headerlink\" title=\"1.安装驱动\"></a>1.安装驱动</h2><p><img src=\"https://obs-one-for-fan.obs.cn-north-1.myhwclouds.com/imageHosting/1547012467893.png\" alt=\"93\"></p>\n<h2 id=\"2-安装python3-6\"><a href=\"#2-安装python3-6\" class=\"headerlink\" title=\"2.安装python3.6\"></a>2.安装python3.6</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">wget http://www.python.org/ftp/python/3.6.4/Python-3.6.4.tgz </div><div class=\"line\">tar -xvzf Python-3.6.4.tgz cd Python-3.6.4 </div><div class=\"line\">./configure --with-ssl </div><div class=\"line\">make </div><div class=\"line\">sudo make install</div><div class=\"line\">sudo apt-get install pip3</div></pre></td></tr></table></figure>\n<h2 id=\"4-CUDA-Toolkit-9-0\"><a href=\"#4-CUDA-Toolkit-9-0\" class=\"headerlink\" title=\"4.CUDA Toolkit 9.0\"></a>4.CUDA Toolkit 9.0</h2><p><a href=\"https://developer.nvidia.com/cuda-90-download-archive?target_os=Linux&amp;target_arch=x86_64&amp;target_distro=Ubuntu&amp;target_version=1604&amp;target_type=deblocal\" target=\"_blank\" rel=\"external\">下载地址</a><br><img src=\"https://obs-one-for-fan.obs.cn-north-1.myhwclouds.com/imageHosting/1547038387531.png\" alt=\"1547038387531\"><br>进入步骤1.1中下载文件<br><code>cuda_9.0.176_384.81_linux.ru</code><br>在安装CUDA前先装依赖包<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">sudo apt-get install freeglut3-dev build-essential libx11-dev libxmu-dev libxi-dev libglu1-mesa-dev</div></pre></td></tr></table></figure></p>\n<p>所在目录，执行如下命令安装CUDA 9.0：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">sudo chmod +x cuda_9.0.176_384.81_linux.run </div><div class=\"line\">sudo ./cuda_9.0.176_384.81_linux.run -override</div></pre></td></tr></table></figure></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div></pre></td><td class=\"code\"><pre><div class=\"line\">Do you accept the previously read EULA?</div><div class=\"line\">accept/decline/quit: accept</div><div class=\"line\"></div><div class=\"line\">You are attempting to install on an unsupported configuration. Do you wish to continue?</div><div class=\"line\">(y)es/(n)o [ default is no ]: y</div><div class=\"line\"></div><div class=\"line\">Install NVIDIA Accelerated Graphics Driver for Linux-x86_64 384.81?</div><div class=\"line\">(y)es/(n)o/(q)uit: n</div><div class=\"line\"></div><div class=\"line\">Install the CUDA 9.0 Toolkit?</div><div class=\"line\">(y)es/(n)o/(q)uit: y</div><div class=\"line\"></div><div class=\"line\">Enter Toolkit Location</div><div class=\"line\"> [ default is /usr/local/cuda-9.0 ]: </div><div class=\"line\"></div><div class=\"line\">Do you want to install a symbolic link at /usr/local/cuda?</div><div class=\"line\">(y)es/(n)o/(q)uit: y</div><div class=\"line\"></div><div class=\"line\">Install the CUDA 9.0 Samples?</div><div class=\"line\">(y)es/(n)o/(q)uit: </div><div class=\"line\">Install the CUDA 9.0 Samples?</div><div class=\"line\">(y)es/(n)o/(q)uit: y</div><div class=\"line\"></div><div class=\"line\">Enter CUDA Samples Location</div><div class=\"line\"> [ default is /home/lovemefan ]: </div><div class=\"line\"></div><div class=\"line\">Installing the CUDA Toolkit in /usr/local/cuda-9.0 ...</div><div class=\"line\">Missing recommended library: libGLU.so</div><div class=\"line\">Missing recommended library: libX11.so</div><div class=\"line\">Missing recommended library: libXi.so</div><div class=\"line\">Missing recommended library: libXmu.so</div><div class=\"line\">Missing recommended library: libGL.so</div><div class=\"line\"></div><div class=\"line\">Installing the CUDA Samples in /home/lovemefan ...</div><div class=\"line\">Copying samples to /home/lovemefan/NVIDIA_CUDA-9.0_Samples now...</div><div class=\"line\">Finished copying samples.</div><div class=\"line\"></div><div class=\"line\">===========</div><div class=\"line\">= Summary =</div><div class=\"line\">===========</div><div class=\"line\"></div><div class=\"line\">Driver:   Not Selected</div><div class=\"line\">Toolkit:  Installed in /usr/local/cuda-9.0</div><div class=\"line\">Samples:  Installed in /home/lovemefan, but missing recommended libraries</div><div class=\"line\"></div><div class=\"line\">Please make sure that</div><div class=\"line\"> -   PATH includes /usr/local/cuda-9.0/bin</div><div class=\"line\"> -   LD_LIBRARY_PATH includes /usr/local/cuda-9.0/lib64, or, add /usr/local/cuda-9.0/lib64 to /etc/ld.so.conf and run ldconfig as root</div><div class=\"line\"></div><div class=\"line\">To uninstall the CUDA Toolkit, run the uninstall script in /usr/local/cuda-9.0/bin</div><div class=\"line\"></div><div class=\"line\">Please see CUDA_Installation_Guide_Linux.pdf in /usr/local/cuda-9.0/doc/pdf for detailed information on setting up CUDA.</div><div class=\"line\"></div><div class=\"line\">***WARNING: Incomplete installation! This installation did not install the CUDA Driver. A driver of version at least 384.00 is required for CUDA 9.0 functionality to work.</div><div class=\"line\">To install the driver using this installer, run the following command, replacing &lt;CudaInstaller&gt; with the name of this run file:</div><div class=\"line\">    sudo &lt;CudaInstaller&gt;.run -silent -driver</div><div class=\"line\"></div><div class=\"line\">Logfile is /tmp/cuda_install_28234.log</div></pre></td></tr></table></figure>\n<h2 id=\"4-CUDNN-7-0\"><a href=\"#4-CUDNN-7-0\" class=\"headerlink\" title=\"4.CUDNN 7.0\"></a>4.CUDNN 7.0</h2><p><a href=\"https://developer.nvidia.com/rdp/cudnn-download\" target=\"_blank\" rel=\"external\">下载地址</a></p>\n<p><img src=\"https://obs-one-for-fan.obs.cn-north-1.myhwclouds.com/imageHosting/1547025670135.png\" alt=\"1547025670135\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">tar -xzvf cudnn-9.0-linux-x64-v7.4.2.24.tgz</div><div class=\"line\">sudo cp cuda/include/cudnn.h /usr/local/cuda/include</div><div class=\"line\">sudo cp cuda/lib64/libcudnn* /usr/local/cuda/lib64</div><div class=\"line\">sudo chmod a+r /usr/local/cuda/include/cudnn.h /usr/local/cuda/lib64/libcudnn*</div></pre></td></tr></table></figure>\n<h2 id=\"5-libcupti\"><a href=\"#5-libcupti\" class=\"headerlink\" title=\"5.libcupti\"></a>5.libcupti</h2><p>安装libcupti库</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">sudo apt-get install libcupti-dev</div></pre></td></tr></table></figure>\n<hr>\n<h2 id=\"6-配置\"><a href=\"#6-配置\" class=\"headerlink\" title=\"6.配置\"></a>6.配置</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">sudo gedit ~/.bashrc</div></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">export CUDA_HOME=/usr/local/cuda</div><div class=\"line\">export PATH=/usr/local/cuda-9.0/bin:$PATH</div><div class=\"line\">export LD_LIBRARY_PATH=/usr/local/cuda-9.0/lib64:$LD_LIBRARY_PATH</div></pre></td></tr></table></figure>\n<p>一定要执行下面命令刷新环境变量</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">. ~/.bashrc</div></pre></td></tr></table></figure>\n<p>pycharm 中配置</p>\n<p>打开 Run-Edit Configurations</p>\n<p><img src=\"https://obs-one-for-fan.obs.cn-north-1.myhwclouds.com/imageHosting/1547275915797.png\" alt=\"1547275915797\"><br>将下面添加到环境变量<br><img src=\"https://obs-one-for-fan.obs.cn-north-1.myhwclouds.com/imageHosting/1547276126564.png\" alt=\"1547276126564\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">LD_LIBRARY_PATH=/usr/local/cuda-9.0=/usr/local/cuda-9.0</div></pre></td></tr></table></figure>\n<h2 id=\"7-测试\"><a href=\"#7-测试\" class=\"headerlink\" title=\"7.测试\"></a>7.测试</h2><p>在pycharm中运行一个hello world<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">import</span>  tensorflow <span class=\"keyword\">as</span> tf</div><div class=\"line\">hello = tf.constant(<span class=\"string\">\"hello tensorflow\"</span>)</div><div class=\"line\"><span class=\"keyword\">with</span> tf.Session() <span class=\"keyword\">as</span> sess :</div><div class=\"line\">    print(sess.run(hello))</div></pre></td></tr></table></figure></p>\n<p>结果如下<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">/usr/bin/python3 /home/lovemefan/python_project/practice/hello_tensorflow.py</div><div class=\"line\">2019-01-12 15:01:21.072275: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA</div><div class=\"line\">2019-01-12 15:01:21.253447: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:964] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero</div><div class=\"line\">2019-01-12 15:01:21.253901: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1432] Found device 0 with properties: </div><div class=\"line\">name: GeForce GTX 970M major: 5 minor: 2 memoryClockRate(GHz): 1.038</div><div class=\"line\">pciBusID: 0000:01:00.0</div><div class=\"line\">totalMemory: 2.95GiB freeMemory: 2.65GiB</div><div class=\"line\">2019-01-12 15:01:21.253925: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1511] Adding visible gpu devices: 0</div><div class=\"line\">2019-01-12 15:01:26.381187: I tensorflow/core/common_runtime/gpu/gpu_device.cc:982] Device interconnect StreamExecutor with strength 1 edge matrix:</div><div class=\"line\">2019-01-12 15:01:26.381251: I tensorflow/core/common_runtime/gpu/gpu_device.cc:988]      0 </div><div class=\"line\">2019-01-12 15:01:26.381271: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1001] 0:   N </div><div class=\"line\">2019-01-12 15:01:26.381661: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1115] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 2345 MB memory) -&gt; physical GPU (device: 0, name: GeForce GTX 970M, pci bus id: 0000:01:00.0, compute capability: 5.2)</div><div class=\"line\">b'hello tensorflow'</div><div class=\"line\"></div><div class=\"line\">Process finished with exit code 0</div></pre></td></tr></table></figure></p>\n","next":{"title":"个人网站首次备案的记录","slug":"为什么要备案"},"link":"/post/Ubunyu 18.04.1 LTS 安装tensorflow-gpu/index.html  2019/03/04","toc":[{"title":"Ubunyu 18.04.1 LTS 安装tensorflow-gpu","id":"Ubunyu-18-04-1-LTS-安装tensorflow-gpu","index":"1","children":[{"title":"1.安装驱动","id":"1-安装驱动","index":"1.1"},{"title":"2.安装python3.6","id":"2-安装python3-6","index":"1.2"},{"title":"4.CUDA Toolkit 9.0","id":"4-CUDA-Toolkit-9-0","index":"1.3"},{"title":"4.CUDNN 7.0","id":"4-CUDNN-7-0","index":"1.4"},{"title":"5.libcupti","id":"5-libcupti","index":"1.5"},{"title":"6.配置","id":"6-配置","index":"1.6"},{"title":"7.测试","id":"7-测试","index":"1.7"}]}]}